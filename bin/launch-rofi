#!/bin/bash

# Launch rofi in application launcher mode
# Replaces launch-walker for a lighter alternative

# Check if rofi is installed
if ! command -v rofi &> /dev/null; then
  notify-send "Error" "rofi is not installed. Please install it with: sudo pacman -S rofi"
  exit 1
fi

# Default mode: drun (application launcher)
MODE="${1:-drun}"

case "$MODE" in
  -m|--mode)
    # Handle mode flag
    case "$2" in
      symbols|emoji)
        # Emoji picker - requires rofi-emoji package
        # rofi-emoji provides a rofi mode
        exec rofi -modi emoji -show emoji
        ;;
      clipboard)
        # Clipboard manager - use cliphist (official package) or wl-clipboard
        if command -v cliphist &> /dev/null; then
          # Ensure cliphist daemon is running (cliphist watch runs the daemon)
          if ! pgrep -f "cliphist watch" > /dev/null; then
            cliphist watch &
            sleep 1
          fi
          exec rofi -modi "clipboard:cliphist list" -show clipboard -run-command 'wl-copy {item}'
        elif command -v wl-copy &> /dev/null; then
          # Fallback: simple clipboard with wl-clipboard (no history)
          exec rofi -modi "clipboard:wl-paste" -show clipboard
        else
          notify-send "Info" "Install cliphist for clipboard manager: sudo pacman -S cliphist"
          exec rofi -show drun
        fi
        ;;
      *)
        exec rofi -show drun
        ;;
    esac
    ;;
  *)
    # Default: application launcher
    exec rofi -show drun
    ;;
esac
