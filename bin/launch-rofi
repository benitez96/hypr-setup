#!/bin/bash

# Launch rofi in application launcher mode
# Replaces launch-walker for a lighter alternative

# Check if rofi is installed
if ! command -v rofi &> /dev/null; then
  notify-send "Error" "rofi is not installed. Please install it with: sudo pacman -S rofi"
  exit 1
fi

# Default mode: drun (application launcher)
MODE="${1:-drun}"

case "$MODE" in
  -m|--mode)
    # Handle mode flag
    case "$2" in
      symbols|emoji)
        # Emoji picker - requires rofi-emoji package
        # rofi-emoji provides a rofi mode
        exec rofi -modi emoji -show emoji
        ;;
      clipboard)
        # Clipboard manager - use cliphist (official package) or wl-clipboard
        if command -v cliphist &> /dev/null && command -v wl-paste &> /dev/null; then
          # Ensure cliphist daemon is running (wl-paste --watch cliphist store)
          # Check for the daemon process
          if ! ps aux | grep -v grep | grep -q "wl-paste --watch cliphist store"; then
            wl-paste --watch cliphist store &
            sleep 1
          fi
          # Use rofi with cliphist: list items, select with rofi, decode and copy
          cliphist list | rofi -dmenu | cliphist decode | wl-copy
        elif command -v wl-copy &> /dev/null; then
          # Fallback: simple clipboard with wl-clipboard (no history)
          exec rofi -modi "clipboard:wl-paste" -show clipboard
        else
          notify-send "Info" "Install cliphist for clipboard manager: sudo pacman -S cliphist"
          exec rofi -show drun
        fi
        ;;
      *)
        exec rofi -show drun
        ;;
    esac
    ;;
  *)
    # Default: application launcher
    exec rofi -show drun
    ;;
esac
