#!/bin/bash

# Check for available package updates (pacman, AUR, flatpak)
# Returns exit code 0 if updates are available, 1 if up to date

updates_available=false
update_count=0

# Check pacman updates
if command -v checkupdates &>/dev/null; then
  pacman_updates=$(checkupdates 2>/dev/null | wc -l)
  if [[ $pacman_updates -gt 0 ]]; then
    updates_available=true
    update_count=$((update_count + pacman_updates))
  fi
elif sudo pacman -Sy &>/dev/null; then
  pacman_updates=$(pacman -Qu 2>/dev/null | wc -l)
  if [[ $pacman_updates -gt 0 ]]; then
    updates_available=true
    update_count=$((update_count + pacman_updates))
  fi
fi

# Check AUR updates (yay)
if command -v yay &>/dev/null && pacman -Qem &>/dev/null; then
  if pkg-aur-accessible &>/dev/null; then
    aur_updates=$(yay -Qua 2>/dev/null | wc -l)
    if [[ $aur_updates -gt 0 ]]; then
      updates_available=true
      update_count=$((update_count + aur_updates))
    fi
  fi
fi

# Check flatpak updates
if command -v flatpak &>/dev/null; then
  if flatpak list &>/dev/null && [[ -n $(flatpak list 2>/dev/null) ]]; then
    flatpak_updates=$(flatpak remote-ls --updates 2>/dev/null | wc -l)
    if [[ $flatpak_updates -gt 0 ]]; then
      updates_available=true
      update_count=$((update_count + flatpak_updates))
    fi
  fi
fi

if [[ "$updates_available" == "true" ]]; then
  echo "Update available ($update_count packages)"
  exit 0
else
  exit 1
fi
