#!/usr/bin/env bash
# Script to update the system (pacman, AUR, and flatpak)

set -e

# Confirm update (only if running interactively)
if [ -t 0 ]; then
    if ! command -v gum &> /dev/null; then
        # If no gum, use simple prompt
        read -p "Update system? (y/N): " -n 1 -r
        echo
        if [[ ! $REPLY =~ ^[Yy]$ ]]; then
            exit 0
        fi
    else
        if ! gum confirm "Update system?"; then
            exit 0
        fi
    fi
fi

# Update package database
echo "Updating package database..."
sudo pacman -Sy

# Update system packages
echo "Updating system packages..."
sudo pacman -Su --noconfirm

# Update AUR packages if yay is available
if command -v yay &> /dev/null; then
    echo "Updating AUR packages..."
    yay -Su --noconfirm
fi

# Update flatpak packages if flatpak is available
if command -v flatpak &> /dev/null; then
    echo "Updating flatpak packages..."
    flatpak update -y
fi

echo ""
echo "Update completed!"

