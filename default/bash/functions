# Compression
compress() { tar -czf "${1%/}.tar.gz" "${1%/}"; }
alias decompress="tar -xzf"

# Transcode a video to a good-balance 1080p that's great for sharing online
# Requires: ffmpeg
transcode-video-1080p() {
  if ! command -v ffmpeg &> /dev/null; then
    echo "Error: ffmpeg is not installed. Install it with: sudo pacman -S ffmpeg"
    return 1
  fi
  ffmpeg -i $1 -vf scale=1920:1080 -c:v libx264 -preset fast -crf 23 -c:a copy ${1%.*}-1080p.mp4
}

# Transcode a video to a good-balance 4K that's great for sharing online
# Requires: ffmpeg
transcode-video-4K() {
  if ! command -v ffmpeg &> /dev/null; then
    echo "Error: ffmpeg is not installed. Install it with: sudo pacman -S ffmpeg"
    return 1
  fi
  ffmpeg -i $1 -c:v libx265 -preset slow -crf 24 -c:a aac -b:a 192k ${1%.*}-optimized.mp4
}

# Transcode any image to JPG image that's great for shrinking wallpapers
# Requires: imagemagick
img2jpg() {
  if ! command -v magick &> /dev/null; then
    echo "Error: ImageMagick is not installed. Install it with: sudo pacman -S imagemagick"
    return 1
  fi
  img="$1"
  shift
  magick "$img" $@ -quality 95 -strip ${img%.*}-optimized.jpg
}

# Transcode any image to JPG image that's great for sharing online without being too big
# Requires: imagemagick
img2jpg-small() {
  if ! command -v magick &> /dev/null; then
    echo "Error: ImageMagick is not installed. Install it with: sudo pacman -S imagemagick"
    return 1
  fi
  img="$1"
  shift
  magick "$img" $@ -resize 1080x\> -quality 95 -strip ${img%.*}-optimized.jpg
}

# Transcode any image to compressed-but-lossless PNG
# Requires: imagemagick
img2png() {
  if ! command -v magick &> /dev/null; then
    echo "Error: ImageMagick is not installed. Install it with: sudo pacman -S imagemagick"
    return 1
  fi
  img="$1"
  shift
  magick "$img" $@ -strip -define png:compression-filter=5 \
    -define png:compression-level=9 \
    -define png:compression-strategy=1 \
    -define png:exclude-chunk=all \
    "${img%.*}-optimized.png"
}
